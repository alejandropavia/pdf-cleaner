<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PDF Cleaner — Herramienta</title>
  <style>
    :root{
      --bg:#f7f8fa; --card:#fff; --text:#0f172a; --muted:#475569;
      --line:#e5e7eb; --shadow:0 10px 30px rgba(0,0,0,0.08);
      --btn:#111; --btn2:#fff; --ok:#16a34a; --danger:#dc2626;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial}
    a{color:inherit;text-decoration:none}
    .wrap{max-width:1080px;margin:0 auto;padding:28px 18px 70px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:14px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900}
    .badge{font-size:12px;padding:6px 10px;border-radius:999px;background:#111;color:#fff}
    .nav{display:flex;gap:14px;font-size:13px;color:var(--muted)}

    .hero{
      margin-top:18px;background:var(--card);border:1px solid var(--line);
      border-radius:18px;padding:26px;box-shadow:var(--shadow);
      display:grid;grid-template-columns:1.25fr 0.75fr;gap:18px
    }
    @media(max-width:900px){.hero{grid-template-columns:1fr}}
    h1{margin:0 0 10px;font-size:40px;line-height:1.05;letter-spacing:-1px}
    @media(max-width:520px){h1{font-size:32px}}
    .sub{margin:0 0 14px;color:var(--muted);font-size:15px;line-height:1.5}

    .field{display:flex;flex-direction:column;gap:6px;margin:12px 0}
    label{font-size:13px;color:var(--muted)}
    input[type="file"], select{
      padding:10px;border-radius:12px;border:1px solid var(--line);background:#fff;
      font-size:14px;
    }

    .ctaRow{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-top:14px}
    .btn{
      border-radius:12px;padding:12px 16px;border:1px solid #111;
      font-weight:800;font-size:14px;cursor:pointer;
      display:inline-flex;align-items:center;gap:10px;
    }
    .btn.primary{background:var(--btn);color:#fff}
    .btn.secondary{background:var(--btn2);color:#111}

    .status{margin-top:12px;font-size:13px;color:var(--muted)}
    .ok{color:var(--ok);font-weight:900}
    .danger{color:var(--danger);font-weight:900}
    .hidden{display:none}

    .result{
      margin-top:16px;
      padding:14px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fafafa;
      font-size:13px;
      color:var(--muted);
      line-height:1.6;
    }
    .result b{color:var(--text)}
    .check{color:var(--ok);font-weight:900}

    .proof{border:1px solid var(--line);border-radius:16px;padding:16px;background:#fafafa}
    .proof b{display:block;margin-bottom:6px}
    .proof ul{margin:0;padding-left:18px;color:var(--muted);font-size:13px}
    .proof li{margin:6px 0}

    .footer{margin-top:22px;text-align:center;color:var(--muted);font-size:12px}

    /* ✅ spinner */
    .spinner{
      width:14px;height:14px;border-radius:50%;
      border:2px solid rgba(255,255,255,0.35);
      border-top-color:#fff;
      animation:spin 0.8s linear infinite;
      display:inline-block;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>

  <script>
    function fmtBytes(bytes){
      const units = ["B","KB","MB","GB"];
      let i = 0;
      let n = Number(bytes || 0);
      while(n >= 1024 && i < units.length-1){ n /= 1024; i++; }
      return `${n.toFixed(i === 0 ? 0 : 2)} ${units[i]}`;
    }

    async function handleSubmit(ev){
      ev.preventDefault();

      const form = document.getElementById("pdfForm");
      const btn = document.getElementById("submitBtn");
      const status = document.getElementById("status");
      const result = document.getElementById("result");
      const download = document.getElementById("downloadLink");

      // reset UI
      result.classList.add("hidden");
      download.classList.add("hidden");
      download.href = "#";
      download.textContent = "";

      // botón loading
      btn.disabled = true;
      btn.style.opacity = "0.8";
      btn.innerHTML = `<span class="spinner"></span> Procesando…`;
      status.textContent = ""; // ✅ no queremos “procesando” abajo, solo en el botón

      try{
        const fd = new FormData(form);

        const res = await fetch("/process", {
          method: "POST",
          body: fd
        });

        if(!res.ok){
          const txt = await res.text();
          status.innerHTML = `<span class="danger">Error:</span> ${txt}`;
          return;
        }

        const inBytes = res.headers.get("x-input-bytes");
        const outBytes = res.headers.get("x-output-bytes");
        const reduction = res.headers.get("x-reduction-pct");
        const totalPages = res.headers.get("x-total-pages");
        const removedPages = res.headers.get("x-removed-pages");

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);

        // filename
        let filename = "output.pdf";
        const cd = res.headers.get("content-disposition") || "";
        const m = cd.match(/filename="([^"]+)"/);
        if(m && m[1]) filename = m[1];

        download.href = url;
        download.download = filename;
        download.textContent = `⬇️ Descargar ${filename}`;
        download.classList.remove("hidden");

        // resultado minimal + tick verde
        const parts = [];
        if(reduction !== null) parts.push(`<span class="check">✓</span> <b>Reducción:</b> <span class="ok">${reduction}%</span>`);
        if(inBytes !== null && outBytes !== null){
          parts.push(`<b>Tamaño:</b> ${fmtBytes(inBytes)} → ${fmtBytes(outBytes)}`);
        }
        if(totalPages) parts.push(`<b>Páginas:</b> ${totalPages}${removedPages ? ` (quitadas: ${removedPages})` : ""}`);

        result.innerHTML = parts.join("<br>");
        result.classList.remove("hidden");

        status.innerHTML = `<span class="ok">Listo.</span>`;

      }catch(e){
        status.innerHTML = `<span class="danger">Error:</span> ${e}`;
      }finally{
        btn.disabled = false;
        btn.style.opacity = "1";
        btn.innerHTML = `Procesar`;
      }
    }
  </script>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="brand"><span class="badge">B2B</span> PDF Cleaner</div>
      <div class="nav">
        <a href="/">Inicio</a>
        <a href="/#precios">Precios</a>
      </div>
    </div>

    <section class="hero">
      <div>
        <h1>Procesa tu PDF</h1>
        <p class="sub">
          Limpia páginas en blanco y comprime tu PDF para email y portales.
          Sin instalaciones. Resultado inmediato.
        </p>

        <form id="pdfForm" onsubmit="handleSubmit(event)" enctype="multipart/form-data">
          <input type="hidden" name="token" value="%%TOKEN%%">

          <div class="field">
            <label><b>1) PDF</b> (solo .pdf)</label>
            <input type="file" name="file" accept="application/pdf" required>
          </div>

          <div class="field">
            <label><b>2) Calidad / Compresión</b></label>
            <select name="quality">
              <option value="screen">Máxima compresión (screen) — ideal para email</option>
              <option value="ebook">Equilibrado (ebook) — buena calidad</option>
              <option value="printer">Mejor calidad (printer) — menos compresión</option>
            </select>
          </div>

          <div class="ctaRow">
            <button id="submitBtn" class="btn primary" type="submit">Procesar</button>
            <a class="btn secondary" href="/">Volver</a>
          </div>

          <div id="status" class="status"></div>

          <div id="result" class="result hidden"></div>

          <div class="ctaRow" style="margin-top:12px;">
            <a id="downloadLink" class="btn primary hidden" href="#">⬇️ Descargar</a>
          </div>

          <div class="footer">Versión: {APP_VERSION}</div>
        </form>
      </div>

      <div class="proof">
  <b>Qué hace exactamente</b>
  <ul>
    <li><span class="check">✓</span> Elimina páginas en blanco</li>
    <li><span class="check">✓</span> Comprime para reducir peso</li>
    <li><span class="check">✓</span> Listo para enviar</li>
  </ul>

  <p class="mini" style="margin-top:10px">
    ℹ️ Si el PDF pierde demasiada calidad, prueba
    <b>Equilibrado</b> o <b>Alta calidad</b>.
  </p>
</div>

    </section>
  </div>
</body>
</html>
